<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lancar.my â€“ Buat Laman Tanpa Kod</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="hero">
    <h1>Bina Laman Web Anda Tanpa Perlu Mengetik Kod</h1>
    <p>
      Lancar.my memudahkan anda mencipta hingga 111 laman pendaratan secara percuma.
      Anda boleh daftar & bayar, atau terus login dengan Magic-Link.
    </p>
    <!-- CTA container -->
    <div id="cta"></div>
  </header>

  <script>
    // Fungsi checkout (panggil serverless, kemudian redirect ke ToyyibPay)
    async function goToCheckout() {
      try {
        const resp = await fetch('/api/create-bill', { method: 'POST' });
        if (!resp.ok) {
          const txt = await resp.text();
          throw new Error(txt || resp.statusText);
        }
        const { billCode } = await resp.json();
        // Tukar kepada dev.toyyibpay.com jika anda ujian di dev
        window.location.href = `https://toyyibpay.com/${billCode}`;
      } catch (err) {
        console.error('checkout error:', err);
        alert('Gagal sambung ke ToyyibPay:\n' + err.message);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('lancarEmail');
      const cta   = document.getElementById('cta');

      if (saved) {
        // Jika email tersimpan, terus ke dashboard
        cta.innerHTML = `
          <a href="/dashboard.html?email=${encodeURIComponent(saved)}"
             class="btn-primary"
          >MASUK KE DASHBOARD</a>
        `;
      } else {
        // Baru: tunjuk dua pilihan
        cta.innerHTML = `
          <button id="daftar-btn" class="btn-primary">
            DAFTAR SEKARANG
          </button>
          <a href="/login.html"
             class="btn-secondary"
             style="margin-left:1rem;"
          >DAFTAR / LOGIN (Magic-Link)</a>
        `;
        document
          .getElementById('daftar-btn')
          .addEventListener('click', goToCheckout);
      }
    });
  </script>
</body>
</html>
